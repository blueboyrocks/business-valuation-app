{
  "project": "ValuationPro",
  "branchName": "ralph/chart-visualization-fixes",
  "description": "Fix multiple chart rendering issues in PDF reports: empty charts with N/A labels, missing Y-axis labels, reversed year order, benchmark lines covered by data, and valuation range chart cutoff.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create Chart Data Validator",
      "description": "As a system, I need to validate chart data before rendering so that broken charts are never displayed.",
      "acceptanceCriteria": [
        "Create lib/charts/chart-validator.ts",
        "validateChartData(config: ChartConfig): ChartValidationResult function",
        "Check: data array not empty",
        "Check: all values are numbers (not NaN, undefined, null)",
        "Check: labels array same length as data array",
        "Check: labels are strings (not objects)",
        "Check: not all labels are 'N/A'",
        "Return { valid, errors[], warnings[], sanitizedConfig? }",
        "Unit tests in lib/charts/__tests__/chart-validator.test.ts",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented in lib/charts/chart-validator.ts with 35 tests"
    },
    {
      "id": "US-002",
      "title": "Implement Chronological Year Sorting",
      "description": "As a system, I need to sort chart data chronologically so that trends read correctly left-to-right (oldest to newest).",
      "acceptanceCriteria": [
        "Add sortChronologically(labels, values) function to chart-validator.ts or new utility",
        "Extract year from label strings (handles '2024', 'FY2024', '2024-Q1' formats)",
        "Sort both labels and values arrays in parallel by year ascending",
        "Oldest year on left, newest on right",
        "Unit tests verify sorting with various label formats",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented extractYear() and sortChronologically() in chart-validator.ts"
    },
    {
      "id": "US-003",
      "title": "Create Placeholder Chart Component",
      "description": "As a system, I need a placeholder for charts with insufficient data so that the report looks intentional rather than broken.",
      "acceptanceCriteria": [
        "Add generatePlaceholderChart(title, reason) function",
        "Returns HTML/SVG that displays 'Insufficient Data for Visualization'",
        "Shows what data was missing (e.g., 'Requires 2+ years of financial data')",
        "Matches styling of other charts (same dimensions, colors from design tokens)",
        "Integrate with chart generator to use placeholder when validation fails",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented generatePlaceholderChart() using design tokens, integrated into all chart generators"
    },
    {
      "id": "US-004",
      "title": "Add Y-Axis Label Generation",
      "description": "As a system, I need to generate Y-axis labels for all charts so that values can be understood.",
      "acceptanceCriteria": [
        "Add generateYAxisLabels(min, max, unit, tickCount) function",
        "Calculate appropriate tick marks (5-7 ticks by default)",
        "Format labels with units (%, $, x as appropriate)",
        "Handle large numbers with abbreviations ($1.5M, $500K)",
        "No overlapping labels (adequate spacing)",
        "Update chart generation to include Y-axis labels",
        "Unit tests verify scale calculation and formatting",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Implemented generateYAxisTicks(), formatYAxisLabel(), generateYAxisLabels() in chart-validator.ts"
    },
    {
      "id": "US-005",
      "title": "Fix Benchmark Line Rendering Order",
      "description": "As a system, I need benchmark lines visible behind data bars so that comparisons can be made.",
      "acceptanceCriteria": [
        "Update SVG chart generation to render in correct order: grid -> benchmark -> data -> labels",
        "Benchmark line rendered AFTER grid lines",
        "Benchmark line rendered BEFORE data bars/lines",
        "Benchmark label positioned to not overlap data",
        "Use dashed line style for visual distinction",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Fixed in kpi-page-generator.ts - benchmark line now renders before data bars"
    },
    {
      "id": "US-006",
      "title": "Fix Valuation Range Chart",
      "description": "As a system, I need to fix the Valuation Range Overview chart so that all elements are visible and properly positioned.",
      "acceptanceCriteria": [
        "Fix 'Your Value' marker so it doesn't cover other text",
        "Ensure Industry Low/High labels visible and connected to chart",
        "Fix container height so bottom is not cut off",
        "Position value marker correctly on the range scale",
        "Use design token colors consistently",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Fixed in puppeteer-chart-renderer.ts: increased height, smart label positioning, clamped marker to visible range"
    },
    {
      "id": "US-007",
      "title": "Create KPI Trend Chart Template",
      "description": "As a system, I need a consistent template for all KPI trend charts so that they all render correctly with the same quality.",
      "acceptanceCriteria": [
        "Create generateKPITrendChart(config) function or component",
        "Props: title, data[], labels[], benchmark?, unit",
        "Handles 1-4 years of data gracefully",
        "Always includes Y-axis with scale labels",
        "Always sorts years chronologically (left=oldest)",
        "Benchmark line visible when provided",
        "Consistent sizing across all KPI charts",
        "Uses validation before rendering (shows placeholder if invalid)",
        "Integrates with PDF generator for all KPI sections",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Enhanced generateInlineSVGChart() in kpi-page-generator.ts with all required features"
    }
  ]
}
